{% extends 'user_side/base2.html' %}
{% load static %}
{% block content %}
<!-- Wallet Section -->
<div class="d-flex justify-content-center m-4">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 mx-auto text-center">
                <div class="container">
                    <h2 class="section-title mb-4">Wallet</h2>
                    <!-- Wallet Balance -->
                    <div class="wallet-balance">
                        <h4>Current Balance: ₹{{ user_wallet.balance }}</h4>
                    </div>
                    <!-- Transaction History -->
                    <div class="transaction-history mt-4">
                        <h3>Transaction History</h3>
                        <div class="table-responsive">
                            <table class="table table-bordered">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Amount</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for transaction in wallet_transaction %}
                                    <tr>
                                        <td>{{ transaction.date }}</td>
                                        <td>₹{{ transaction.amount }}</td>
                                    </tr>
                                    {% empty %}
                                    <tr>
                                        <td colspan="2" class="text-center">No transactions yet.</td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- Add Money Button -->
                    <div class="add-money mt-4">
                        <form id="addMoneyForm">
                            {% csrf_token %}
                            <input type="number" name="amount" placeholder="Enter amount in ₹" class="form-control mb-2" required>
                            <button type="submit" class="btn btn-primary">Add Money</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(document).ready(function() {
        $('#addMoneyForm').submit(function(e) {
            e.preventDefault();
            var formData = $(this).serialize();
            $.ajax({
                type: 'POST',
                url: '{% url "wallet:wallet" %}',
                data: formData,
                success: function(response) {
                    if (response.success) {
                        var orderId = response.order_id;
                        var amount = response.amount;
                        // Redirect to payment gateway with orderId and amount
                        // Example: window.location.href = '/payment_gateway?order_id=' + orderId + '&amount=' + amount;
                        console.log("Payment Gateway URL: " + '/payment_gateway?order_id=' + orderId + '&amount=' + amount);
                    } else {
                        alert("Failed to create payment order. Please try again.");
                    }
                },
                error: function(xhr, status, error) {
                    alert("Error occurred. Please try again later.");
                }
            });
        });
    });
</script>
{% endblock %}
